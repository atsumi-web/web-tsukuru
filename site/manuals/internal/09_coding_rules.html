<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity直伝・コーディングの鉄則</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .site-header {
            background: #fff;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 30px;
            text-align: center;
        }
        .site-header h1 {
            margin: 0;
            font-size: 1.8rem;
            color: #2c3e50;
        }
        .breadcrumb {
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        .breadcrumb a {
            color: #666;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .content {
            background: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        h2 {
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h3 {
            background: #f1f8ff;
            padding: 10px 15px;
            border-left: 5px solid #0366d6;
            border-radius: 4px;
            margin-top: 30px;
            font-size: 1.2rem;
        }
        .rule-box {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        .rule-box.bad {
            border-color: #ffaeb6;
            background: #fff5f6;
        }
        .rule-box.good {
            border-color: #a3d9a5;
            background: #f0fff4;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .badge-bad {
            background: #d73a49;
            color: #fff;
        }
        .badge-good {
            background: #28a745;
            color: #fff;
        }
        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: Consolas, monospace;
            font-weight: bold;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 0.9rem;
            margin-top: 40px;
        }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="container">
            <h1>Antigravity直伝・コーディングの鉄則</h1>
            <p>「修正の無限ループ」から抜け出すための10の鉄則</p>
        </div>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="../admin/index.html">← マニュアル一覧に戻る</a>
        </div>

        <main class="content">
            
            <div class="highlight-box" style="background: #e6fffa; border-left: 4px solid #38b2ac; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">🛡️ これはなに？</h3>
                <p>「コードが複雑化して修正できなくなる」問題を解決するための、Antigravityとの約束事（鉄の掟）です。<br>
                17個のルールを10個に整理し、実用的で覚えやすいルールセットにしました。</p>
            </div>

            <h2>1. モバイルファースト（小は大を兼ねない！）</h2>
            <p><strong>「まずスマホ版のデザインを先に書く」</strong>。これだけでコード量は半分になります。</p>
            
            <div class="rule-box bad">
                <span class="badge badge-bad">NG: Webファースト</span>
                <p>デスクトップ版を先に作ると、スマホ版で「打ち消し」のコードが大量に必要になります。<br>
                <code>padding: 0; border: none; flex-direction: column;</code><br>
                ↑こんなコードが増えたら要注意です。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK: モバイルファースト</span>
                <p>スマホ版をベースにすれば、デスクトップ版は「追加」だけで済みます。<br>
                「スマホでシンプルな形を作る」→「画面が広かったら横並びにする（@media）」</p>
            </div>

            <h2>2. 単一の情報源（One Source of Truth）</h2>
            <p><strong>同じ内容を2箇所に書かない。必ず1箇所だけに定義する。</strong></p>

            <h3>原則：元の場所を直接修正</h3>
            <div class="rule-box bad">
                <span class="badge badge-bad">NG：継ぎ足し方式</span>
                <p>既存のコードには触らず、一番下に新しいCSSを書いて上書きする。<br>
                → どこが有効なのか分からなくなり、管理不能になります。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：元の場所を直接修正</span>
                <p><strong>勇気を出して、元の記述を書き換える。</strong><br>
                ファイル内検索（Ctrl+F）を使って、該当箇所の元の記述を探し出し、そこを直接修正します。</p>
            </div>

            <h3>具体例：インラインCSS vs 外部CSS</h3>
            <div class="rule-box bad">
                <span class="badge badge-bad">NG：重複定義</span>
                <p><code>index.html</code> のインラインCSSと <code>renewal.css</code> の両方に同じクラスを定義する。<br>
                → 修正時に両方を直さないと不整合が発生し、デザインが崩れます。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：役割を明確に分離</span>
                <h4 style="margin:10px 0; font-size:0.95rem;">インラインCSSに書いて良いもの</h4>
                <ul style="margin-left:20px;">
                    <li>✅ <code>@font-face</code> 定義</li>
                    <li>✅ CSS変数（<code>:root</code>）</li>
                    <li>✅ 基本レイアウト（<code>html</code>, <code>body</code>）</li>
                </ul>
                
                <h4 style="margin:10px 0; font-size:0.95rem; color:#d73a49;">外部CSSのみに書くべきもの</h4>
                <ul style="margin-left:20px;">
                    <li>❌ コンポーネントスタイル（<code>.section-badge</code>, <code>.cta-button</code>など）</li>
                    <li>❌ レスポンシブルール（<code>@media</code>クエリ）</li>
                    <li>❌ アニメーション（<code>@keyframes</code>）</li>
                </ul>
                
                <p style="margin-top:15px;"><strong>CSS修正ワークフロー：</strong><br>
                ① 外部CSS（<code>renewal.css</code>）を直接修正<br>
                ② <code>.min.css</code> に同期：<code>Copy-Item -Force "css\renewal.css" "css\renewal.min.css"</code><br>
                ③ インラインCSSは絶対に触らない（フォント定義や変数以外）</p>
            </div>

            <h2>3. Flexbox/Grid優先、絶対配置は装飾のみ</h2>
            <p>コンテンツ（文字や画像）を <code>position: absolute</code> で無理やり配置するのはやめましょう。</p>

            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p>中身の配置は必ず <code>Flexbox</code> か <code>Grid</code> を使います。<br>
                <code>absolute</code> は<strong>「背景の赤い丸」や「装飾アイコン」</strong> など、崩れても読めるものだけに限定します。</p>
            </div>

            <h2>4. セクションは独立させる（padding内完結）</h2>
            <p>求人LPは「先輩の声を上にしたい」「募集要項を最後にしたい」など、頻繁な並び替えが発生します。</p>

            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p>各セクションは上下に依存する余白(<code>margin-top/bottom</code>)を持たせない。<br>
                自分の内側の余白(<code>padding</code>)だけで完結させる。<br>
                → これなら、どの順番に入れ替えてもレイアウトが崩れません。</p>
            </div>

            <h2>5. !importantとインラインスタイル禁止</h2>
            <p><code>!important</code> を使いたくなったら、それはCSSの設計が破綻しかけている合図です。</p>

            <div class="rule-box bad">
                <span class="badge badge-bad">NG</span>
                <p><code>width: 100% !important;</code><br>
                これを使うと、後で「やっぱり変更したい」と思った時に、誰も修正できなくなります。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：解決策</span>
                <ul>
                    <li><code>:where()</code> セレクタでベーススタイルを定義（詳細度を上げない）</li>
                    <li>HTMLのクラス名を見直す</li>
                    <li>セレクタの強さ（詳細度）を整理する</li>
                </ul>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">🔄 実践：無限修正ループからの脱出</h3>
                <p>今回のセッションで実際に起きた「試行錯誤→重複→文字化け」の悪循環を防ぐための必須ルール</p>
            </div>

            <h2>6. Git必須＋段階的確認</h2>
            <p>「ちょっと試してみる」が取り返しのつかない事態を招きます。</p>

            <h3>①変更前に必ずコミット</h3>
            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">git add .
git commit -m "PRICE section 修正前"

# 実験的な変更はブランチで
git checkout -b fix/price-section</pre>
                <p>これで、いつでも <code>git reset --hard HEAD</code> で戻れます。</p>
            </div>

            <h3>②ワンステップ・ワンテスト</h3>
            <div class="rule-box bad">
                <span class="badge badge-bad">NG：一気に変更</span>
                <p>ボタンの幅 + 色 + フォント + 位置を同時に変更。<br>
                → どれが原因でデザインが崩れたのか特定不可能。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：1つずつ確認</span>
                <ol>
                    <li>ボタンの幅を変更 → <strong>ブラウザ確認</strong></li>
                    <li>OK → 色を変更 → <strong>ブラウザ確認</strong></li>
                    <li>OK → フォントを変更 → <strong>ブラウザ確認</strong></li>
                </ol>
            </div>

            <h3>③ブラウザ確認の最低限項目</h3>
            <div class="rule-box good">
                <span class="badge badge-good">必須チェック</span>
                <ul>
                    <li>✅ <strong>デスクトップ表示</strong>（Chrome/Edge）</li>
                    <li>✅ <strong>スマホ表示</strong>（DevTools: F12 → デバイスモード）</li>
                    <li>✅ <strong>ボタンのクリック可否</strong>（実際にクリックしてみる）</li>
                    <li>✅ <strong>テキストの読みやすさ</strong>（コントラスト、文字サイズ）</li>
                </ul>
                <p>特に、<strong>スマホ表示は必須</strong>。ユーザーの8割はスマホです。</p>
            </div>

            <h3>④ロールバック手順</h3>
            <div class="rule-box good">
                <span class="badge badge-good">戻し方</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;"># 最後のコミットに戻す
git reset --hard HEAD

# 特定のコミットに戻す
git reset --hard [コミットID]

# ファイル単位で戻す
git checkout HEAD -- file.css</pre>
                <p style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-left: 3px solid #4caf50; border-radius: 4px;">
                    <strong>💡 ビジュアルツールでの復旧方法</strong><br>
                    VS Codeのタイムライン機能やGit Graphを使った画像付きの復旧手順は、
                    <a href="trouble_recovery.html" style="color: #2563eb; font-weight: bold;">トラブル・復旧マニュアル</a>を参照してください。
                </p>
            </div>

            <h2>7. 環境設定の徹底（UTF-8, PowerShell対応）</h2>
            <p><strong>【重要】PowerShellでファイルを保存する際の注意</strong></p>

            <div class="rule-box bad">
                <span class="badge badge-bad">問題</span>
                <p>PowerShellの <code>Set-Content</code> や <code>Out-File</code> は、デフォルトでUTF-16 LEまたはシステムデフォルトエンコーディングで保存される。<br>
                これにより、日本語コメントを含むHTML/CSS/JSファイルが文字化けする。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK（UTF-8 BOMなしを明示）</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">[System.IO.File]::WriteAllText('file.css', $content, (New-Object System.Text.UTF8Encoding $false))</pre>
                <p><strong>確認方法：</strong> VS Codeの右下に表示されるエンコーディングが「UTF-8」であることを必ず確認する。</p>
            </div>

            <h3>コマンド実行前チェックリスト</h3>
            <div class="rule-box good">
                <span class="badge badge-good">実行前チェック</span>
                <ul style="list-style: none; padding-left: 0;">
                    <li>☐ <code>-Encoding UTF8</code> は指定したか？</li>
                    <li>☐ バックアップは取ったか？（<code>cp file.css file.css.bak</code>）</li>
                    <li>☐ 対象ファイルのパスは正しいか？</li>
                    <li>☐ Gitでコミット済みか？</li>
                </ul>
            </div>

            <h2>8. CVボタンは共通パーツ化</h2>
            <p>LPの唯一の目的は「応募」です。デザイン崩れでボタンが押せなくなることだけは万死に値します。</p>

            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p><strong>最強の共通パーツを作る。</strong><br>
                <code>.btn-cta</code> のような共通クラスを作り、どのページ、どの場所に置いても絶対に崩れないように独立させて管理します。</p>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #e8f5e9; border-left: 4px solid #00c853; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">⚡ Performance First Coding</h3>
                <p>「後から高速化」は泥沼の元。最初から「爆速」で作るための鉄則。</p>
            </div>

            <h2>9. Performance First（画像・動画・ライブラリ最適化）</h2>

            <h3>① 文字・即・テキスト（脱・画像化）</h3>
            <div class="rule-box bad">
                <span class="badge badge-bad">NG</span>
                <p>Photoshopで作った画像の中に文字を埋め込む。<br>
                → 時給が50円変わるだけで画像の作り直しが発生します。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p><strong>HTMLテキスト＋CSSで作る。</strong><br>
                変更の可能性がある情報は、意地でもテキストデータとして実装します。</p>
            </div>

            <h3>② Inline SVG（脱・アイコンフォント）</h3>
            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p>FontAwesome等のアイコンフォントは<strong>使用禁止</strong>（250KBの無駄）。<br>
                アイコンは必ずSVGコードとしてHTMLに埋め込む。</p>
            </div>

            <h3>③ JS Media Injection（動画の遅延読込）</h3>
            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p>動画などの重いファイルは、HTMLに直接書かない。<br>
                <code>window.innerWidth</code> でPC判定してから、JSでタグを生成・注入する。<br>
                （スマホでの裏ダウンロードを完全に防ぐため）</p>
            </div>

            <h3>④ Mobile Q50（スマホ画像は品質50）</h3>
            <div class="rule-box good">
                <span class="badge badge-good">OK</span>
                <p>スマホ用画像は品質(Quality)を <strong>50</strong> まで落とす。<br>
                小さな画面では劣化が気にならず、容量を劇的に削減できる。</p>
            </div>

            <h2>10. AI協働時の注意点</h2>
            <p>AIが生成するコードやコマンドの特性を理解し、事故を未然に防ぎます。</p>

            <div class="rule-box good">
                <span class="badge badge-good">環境を明示する</span>
                <ul>
                    <li>OS（Windows）、シェル（PowerShell）、エンコーディング（UTF-8）を常に意識させる</li>
                    <li>PowerShell環境では <code>grep</code> ではなく <code>Select-String</code> を使うよう指示</li>
                </ul>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">段階的に確認する</span>
                <ul>
                    <li>AIが生成したコードを盲信せず、必ずブラウザで確認（ルール6）を行う</li>
                    <li>一気に大量の修正を頼まず、セクションごとに段階的に依頼する</li>
                </ul>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #ffebee; border-left: 4px solid #e53935; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">🛡️ 文字化け防止の最優先ルール</h3>
                <p>今回のような「ナビゲーション文字化け大量発生」を二度と起こさないための必須プロトコル</p>
            </div>

            <h2>11. 文字化け完全防止プロトコル</h2>
            <p><strong>【最重要】文字化けは「起きてから直す」のではなく「起きないようにする」</strong></p>

            <h3>① プロジェクト設定を強制する</h3>
            <div class="rule-box good">
                <span class="badge badge-good">必須設定</span>
                <p><strong>`.vscode/settings.json` を作成</strong>（プロジェクト全体に適用）:</p>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">{
  "files.encoding": "utf8",
  "files.autoGuessEncoding": false,
  "files.eol": "\n"
}</pre>
                <p style="margin-top:10px;"><strong>`.editorconfig` を確認</strong>（既存ファイルを更新）:</p>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true</pre>
            </div>

            <h3>② ファイル作成時の鉄則</h3>
            <div class="rule-box good">
                <span class="badge badge-good">3ステップチェック</span>
                <p><strong>絶対に守る3つのステップ:</strong></p>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li><strong>テンプレートからコピー</strong>（ゼロから作らない）</li>
                    <li><strong>右下のエンコーディング表示を確認</strong>（必ずUTF-8）</li>
                    <li><strong>日本語を1文字入力→保存→ブラウザ確認</strong>（文字化けテスト）</li>
                </ol>
            </div>

            <h3>③ PowerShellスクリプトのテンプレート</h3>
            <div class="rule-box good">
                <span class="badge badge-good">安全なヘルパー関数</span>
                <p><strong>全てのスクリプトに必須のヘッダー:</strong></p>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;"># ===== エンコーディング安全設定 =====
$OutputEncoding = [System.Text.Encoding]::UTF8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

# ファイル保存時は必ずこのヘルパー関数を使う
function Save-Utf8NoBom {
    param([string]$Path, [string]$Content)
    $utf8 = New-Object System.Text.UTF8Encoding $false
    [System.IO.File]::WriteAllText($Path, $Content, $utf8)
}</pre>
            </div>

            <h3>④ 文字化けチェックリスト（毎回実行）</h3>
            <div class="rule-box good">
                <span class="badge badge-good">作業前チェック</span>
                <p><strong>新規HTMLファイル作成後:</strong></p>
                <ul style="list-style: none; padding-left: 0;">
                    <li>☐ VSCode右下が「UTF-8」表示か？</li>
                    <li>☐ 日本語コメント <code>&lt;!-- テスト --&gt;</code> を入力して保存</li>
                    <li>☐ ブラウザで開いて日本語が正しく表示されるか？</li>
                    <li>☐ Gitでコミット（<code>git add</code> → <code>git commit</code>）</li>
                </ul>
                
                <p style="margin-top:15px;"><strong>PowerShellでファイル操作後:</strong></p>
                <ul style="list-style: none; padding-left: 0;">
                    <li>☐ <code>-Encoding UTF8</code> パラメータを付けたか？</li>
                    <li>☐ または <code>Save-Utf8NoBom</code> 関数を使ったか？</li>
                    <li>☐ VSCodeで開いて日本語が崩れていないか？</li>
                </ul>
            </div>

            <h3>⑤ 緊急復旧コマンド</h3>
            <div class="rule-box good">
                <span class="badge badge-good">文字化け発見時</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;"># 1. Gitで元に戻す（最優先）
git checkout HEAD -- ファイル名.html

# 2. または手動で修正
$content = Get-Content "ファイル.html" -Raw -Encoding UTF8
$utf8 = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText("ファイル.html", $content, $utf8)</pre>
            </div>

            <div class="rule-box" style="background: #fff3cd; border-color: #ffc107;">
                <span class="badge" style="background: #ff6f00; color: white;">重要な習慣</span>
                <p><strong>作業開始前に必ずこのルールをAntigravityに見せる</strong></p>
                <p>「これから〇〇の作業をします。コーディング規則を確認してください」と伝えることで、<br>
                AIが事前にエンコーディングやGitコミットの注意点を意識した提案をしてくれます。</p>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #e3f2fd; border-left: 4px solid #1565c0; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">📁 CSSファイル管理</h3>
                <p>「ちょっとした追加」のたびにCSSファイルが増えると、優先順位が複雑化し、修正が効かなくなります</p>
            </div>

            <h2>12. CSSファイルは増やさない（1LP = 1CSS）</h2>
            <p><strong>【重要】機能追加のたびに新しいCSSファイルを作るのは絶対禁止。</strong></p>

            <div class="rule-box bad">
                <span class="badge badge-bad">NG：ファイル増殖</span>
                <p>「CTAを強化したい」→ <code>cta-enhancement.css</code> を新規作成<br>
                「ヒーローを調整したい」→ <code>hero-fix.css</code> を新規作成<br>
                → どのファイルが優先されるか分からなくなり、修正が効かない事態に。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：1LP = 最大2ファイル</span>
                <h4 style="margin:10px 0; font-size:0.95rem;">許可されるCSS構成</h4>
                <ul style="margin-left:20px;">
                    <li>✅ <strong>インラインCSS（<code>&lt;style&gt;</code>タグ）</strong>：フォント定義・CSS変数・FOUC防止の最小限のみ</li>
                    <li>✅ <strong>外部CSS 1本（<code>renewal.css</code>）</strong>：全スタイルをここに集約</li>
                </ul>
                
                <h4 style="margin:10px 0; font-size:0.95rem; color:#d73a49;">禁止事項</h4>
                <ul style="margin-left:20px;">
                    <li>❌ 機能単位でCSSファイルを分割（<code>cta-enhancement.css</code> など）</li>
                    <li>❌ 修正用の上書きCSS（<code>hero-fix.css</code> など）</li>
                    <li>❌ AIに「新しいCSSファイルを作って」と依頼すること</li>
                </ul>
                
                <p style="margin-top:15px;"><strong>新機能を追加したいときは：</strong><br>
                <code>renewal.css</code> の該当セクションを探して、そこに直接追記する。</p>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #fce4ec; border-left: 4px solid #c62828; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">🔗 CSS変数の罠</h3>
                <p>「変数は定義したはず」と思っていたら、実は自分自身を参照していた——このバグは発見が非常に困難です</p>
            </div>

            <h2>13. CSS変数は必ず具体値で定義する（循環参照禁止）</h2>
            <p><strong>【重要】<code>:root</code> で変数を定義するとき、値に同名の変数を使ってはいけません。</strong></p>

            <div class="rule-box bad">
                <span class="badge badge-bad">NG：自己参照（循環参照）</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">:root {
  /* ❌ 自分自身を参照 → 値が無効になる（テキストが消える） */
  --text-main: var(--text-main);
  --text-muted: var(--text-muted);
  --bg-light: var(--bg-light);
}</pre>
                <p>→ この変数を使った <code>color: var(--text-main)</code> などは値なしになり、<strong>テキストが見えなくなります。</strong></p>
            </div>

            <div class="rule-box bad">
                <span class="badge badge-bad">NG：他ファイル依存（暗黙の参照）</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">/* renewal.css の :root で定義 */
:root {
  /* ❌ base.cssで定義されているはず、という前提で書く */
  --text-main: var(--color-neutral-dark); /* base.cssにあるかも？ */
}</pre>
                <p>→ 読み込み順や定義の有無によって動いたり動かなかったりする <strong>不安定なコード</strong>になります。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">OK：必ず具体値を書く</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">:root {
  /* ✅ 具体的な値を直接書く */
  --text-main: #333333;
  --text-sub: #555555;
  --text-muted: #888888;
  --bg-light: #f4f6f9;
  --border-light: rgba(0, 26, 61, 0.1);
}</pre>
                <p>→ どのファイルが先に読まれても、必ず正しい値が適用されます。</p>
            </div>

            <div class="rule-box good">
                <span class="badge badge-good">確認コマンド（DevTools）</span>
                <p>変数の値が正しく設定されているかは、ブラウザのDevToolsで確認できます：</p>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li>F12 → 「要素」タブで対象の要素を選択</li>
                    <li>右の「スタイル」パネルで <code>color: var(--text-main)</code> を探す</li>
                    <li>変数名の横に色が表示されていれば正常。何も表示されなければ循環参照の疑いあり</li>
                </ol>
            </div>

            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #fff9c4; border-left: 4px solid #fbc02d; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">📝 まとめ：13の鉄則</h3>
                <ol style="line-height: 2;">
                    <li>モバイルファースト</li>
                    <li>単一の情報源（One Source of Truth）</li>
                    <li>Flexbox/Grid優先、絶対配置は装飾のみ</li>
                    <li>セクションは独立させる（padding内完結）</li>
                    <li>!importantとインラインスタイル禁止</li>
                    <li><strong>Git必須＋段階的確認</strong></li>
                    <li><strong>環境設定の徹底（UTF-8, PowerShell対応）</strong></li>
                    <li><strong>CVボタンは共通パーツ化</strong></li>
                    <li><strong>Performance First</strong></li>
                    <li><strong>AI協働時の注意点</strong></li>
                    <li><strong style="color: #e53935;">文字化け完全防止プロトコル</strong></li>
                    <li><strong style="color: #1565c0;">CSSファイルは増やさない（1LP = 1CSS）</strong></li>
                    <li><strong style="color: #c62828;">CSS変数は必ず具体値で定義する（循環参照禁止）</strong></li>
                </ol>
                <p><strong>これらを守れば、「修正の無限ループ」から必ず脱出できます。</strong></p>
                <p style="margin-top:10px; font-size:0.9rem; color:#555;">📅 事例集（困った時の事例集セクション参照）</p>
            </div>


            <hr style="margin: 50px 0; border: 0; border-top: 2px dashed #ccc;">

            <div class="highlight-box" style="background: #f0f4ff; border-left: 4px solid #4361ee; padding: 15px; margin-bottom: 30px;">
                <h3 style="margin-top:0; border:none; padding:0; background:none;">🔍 困った時の事例集</h3>
                <p>実際のデバッグで発見した「これが原因だった」を症状ベースで記録。同じ罠に2度ハマらないために。<br><small>📅 2026-02-21 追記（堀田建設LP モバイルデバッグセッション）</small></p>
            </div>

            <h2>事例1：モバイルで画像の上に空白が出る</h2>
            <p><strong>症状：</strong>Broken GridをモバイルでリセットしたのにデスクトップのCSS（position:sticky）が残り、画像が下にずれる。</p>
            <div class="rule-box bad">
                <span class="badge badge-bad">原因</span>
                <p><code>position: sticky</code> の <code>top: 100px</code> が、<code>position: relative</code> にリセット後も残る。</p>
            </div>
            <div class="rule-box good">
                <span class="badge badge-good">解決策</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">.visual { position: relative; top: auto; /* ← 必須！ */ width: 100%; margin: 0; }</pre>
            </div>

            <h2>事例2：モバイルでカードの右側が見切れる</h2>
            <p><strong>症状：</strong>特定のカード（reverseクラス）だけ右端が画面からはみ出す。他のカードは正常。</p>
            <div class="rule-box bad">
                <span class="badge badge-bad">原因</span>
                <p>デスクトップの <code>max-width: 1100px</code> がモバイルで残り、containerのpaddingを超えて画面幅を突き破る。</p>
            </div>
            <div class="rule-box good">
                <span class="badge badge-good">解決策</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">/* モバイル用に親カードへ追加 */
.card { max-width: 100%; overflow: hidden; }</pre>
            </div>

            <h2>事例3：モバイルCSSが効かない（詳細度負け）</h2>
            <p><strong>症状：</strong>モバイル用の <code>margin: 0</code> を書いたのにデスクトップのスタイルが残っている。</p>
            <div class="rule-box bad">
                <span class="badge badge-bad">原因</span>
                <p>デスクトップセレクターのクラス数が多く（詳細度が高く）、モバイルセレクターが負けている。</p>
            </div>
            <div class="rule-box good">
                <span class="badge badge-good">解決策：親セレクターを追加して詳細度を上げる</span>
                <pre style="background: #f6f8fa; padding: 15px; border-radius: 4px; overflow-x: auto;">/* NG（詳細度が低くてデスクトップに負ける） */
body .card .visual { margin: 0; }

/* OK（親クラスを足して詳細度を上げる。!importantは不要） */
body .voice-grid .card .visual { margin: 0; }</pre>
            </div>

            <h2>事例4：デプロイ成功なのにスマホに反映されない</h2>
            <div class="rule-box good">
                <span class="badge badge-good">デバッグ手順（この順番で試す）</span>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li><strong>ファイル確認：</strong><code>Select-String</code>で変更が実際に書き込まれているか確認</li>
                    <li><strong>PCで確認：</strong>F12 → Network → 「キャッシュを無効化」→ Ctrl+Shift+R</li>
                    <li><strong>バージョンバンプ：</strong>CSS読み込みを <code>renewal.css?v=9.2</code> のように更新</li>
                    <li><strong>スマホのシークレットモード：</strong>スマホはPCと別キャッシュのためIncognitoで確認</li>
                </ol>
            </div>

            <h2>事例5：カード内h3の改行でカード高さが揃わない</h2>
            <div class="rule-box good">
                <span class="badge badge-good">ルール：br-sp-only の使い分け</span>
                <ul style="margin-left: 20px;">
                    <li>✅ セクション <code>&lt;h2&gt;</code>：<strong>残してOK</strong>（リズム調整）</li>
                    <li>❌ カード内 <code>&lt;h3&gt;</code>：<strong>必ず削除</strong>（高さが揃わなくなる）</li>
                </ul>
            </div>

        </main>

        <footer>
            <p>&copy; 2026 Webをつくるしごと All Rights Reserved.</p>
        </footer>
    </div>

<!-- GLOBAL NAVIGATION -->
<style>
    .global-nav { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 9999; }
    .nav-btn { width: 50px; height: 50px; border-radius: 50%; background: #0F172A; color: #C5A059; display: flex; align-items: center; justify-content: center; text-decoration: none; box-shadow: 0 5px 20px rgba(0,0,0,0.3); transition: all 0.3s; border: 2px solid #C5A059; font-size: 1.2rem; cursor: pointer; }
    .nav-btn:hover { transform: translateY(-3px); background: #C5A059; color: #0F172A; }
    .to-top { opacity: 0; pointer-events: none; }
    .to-top.visible { opacity: 1; pointer-events: all; }
</style>
<div class="global-nav">
    <a href="../admin/Private_index.html" class="nav-btn" title="制作コックピットへ"><i class="fa-solid fa-tower-broadcast"></i></a>
    <div class="nav-btn to-top" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="ページトップへ"><i class="fa-solid fa-arrow-up"></i></div>
</div>
<script>
    window.addEventListener('scroll', () => {
        const toTop = document.querySelector('.to-top');
        if (window.scrollY > 300) toTop.classList.add('visible');
        else toTop.classList.remove('visible');
    });
</script>
</body>
</html>
